<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="Ansonika">
		<title>我的订单</title>

		<!-- Favicons-->
		<link rel="apple-touch-icon" type="image/x-icon" href="img/apple-touch-icon-57x57-precomposed.png">
		<link rel="apple-touch-icon" type="image/x-icon" sizes="72x72"
			href="img/apple-touch-icon-72x72-precomposed.png">
		<link rel="apple-touch-icon" type="image/x-icon" sizes="114x114"
			href="img/apple-touch-icon-114x114-precomposed.png">
		<link rel="apple-touch-icon" type="image/x-icon" sizes="144x144"
			href="img/apple-touch-icon-144x144-precomposed.png">

		<!-- GOOGLE WEB FONT -->
		<link rel="dns-prefetch" href="https://fonts.gstatic.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
		<link rel="preload" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&display=swap"
			as="fetch" crossorigin="anonymous">
		<script>
			! function(e, n, t) {
				"use strict";
				var o = "https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&display=swap",
					r = "__3perf_googleFonts_c2536";

				function c(e) {
					(n.head || n.body).appendChild(e)
				}

				function a() {
					var e = n.createElement("link");
					e.href = o, e.rel = "stylesheet", c(e)
				}

				function f(e) {
					if (!n.getElementById(r)) {
						var t = n.createElement("style");
						t.id = r, c(t)
					}
					n.getElementById(r).innerHTML = e
				}
				e.FontFace && e.FontFace.prototype.hasOwnProperty("display") ? (t[r] && f(t[r]), fetch(o).then(function(e) {
					return e.text()
				}).then(function(e) {
					return e.replace(/@font-face {/g, "@font-face{font-display:swap;")
				}).then(function(e) {
					return t[r] = e
				}).then(f).catch(a)) : a()
			}(window, document, localStorage);
		</script>

		<!-- BASE CSS -->
		<link href="css/bootstrap.custom.min.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">

		<!-- SPECIFIC CSS -->
		<link href="css/blog.css" rel="stylesheet">
		<link href="css/manageorder.css" rel="stylesheet">

	</head>

	<body onload="showOrder(),identify(),nameLoad()">

		<div id="page">

			<header class="version_1">
				<div class="layer"></div><!-- Mobile menu overlay mask -->
				<div class="main_header">
					<div class="container">
						<div class="row small-gutters">
							<div class="col-xl-3 col-lg-3 d-lg-flex align-items-center">
								<div id="logo">
									<a href="index.html"><img src="img/brands/logo.png" alt="" width="150"
											height="55"></a>
								</div>
							</div>
							<nav class="col-xl-6 col-lg-7">

								<!-- Mobile menu button -->
								<div class="main-menu">
									<div id="header_menu">
										<a href="index.html"><img src="img/logo_black.svg" alt="" width="100"
												height="35"></a>
										<a href="#" class="open_close" id="close_in"><i class="ti-close"></i></a>
									</div>
								</div>


								<!--/main-menu -->
							</nav>

						</div>
						<!-- /row -->
					</div>
				</div>
				<!-- /main_header -->
				<div class="main_nav inner Sticky">
					<div class="container">
						<div class="row small-gutters">
							<div class="col-xl-3 col-lg-3 col-md-3" style="width: 300px;height: 60px;padding-top: 25px;">
								<div class="page_header">
									<div class="breadcrumbs">
										<ul>
											<li><a href="./index.html">主页</a></li>
											<li><a href="#">我的订单</a></li>
										</ul>
									</div>
								</div>
							</div>
							<div class="col-xl-6 col-lg-7 col-md-6 d-none d-md-block">
								<div class="custom-search-input" style="display: none;">
									<!-- <input type="text" placeholder="搜索商品" id="searchName">
									<button type="submit" onclick="search()"><i class="header-icon_search_custom"></i></button> -->
								</div>
							</div>
							<div class="col-xl-3 col-lg-2 col-md-3">
								<ul class="top_tools">
									<li>
										<div class="dropdown dropdown-cart">
											<a href="cart.html" class="cart_bt"><strong>2</strong></a>
											<div class="dropdown-menu">
												<!-- <ul>
													<li>
														<a href="product-detail-1.html">
															<figure><img src="img/products/product_placeholder_square_small.jpg" data-src="img/products/shoes/thumb/1.jpg" alt="" width="50" height="50" class="lazy"></figure>
															<strong><span>1x Armor Air x Fear</span>$90.00</strong>
														</a>
														<a href="#0" class="action"><i class="ti-trash"></i></a>
													</li>											
												</ul> -->
												<div class="total_drop">
													<div class="clearfix">
														<strong>Total</strong>
														<!-- <span>$200.00</span> -->
													</div>
													<a href="./cart.html" class="btn_1 outline">查看购物车</a><a href="./checkout.html" class="btn_1">去结算</a>
												</div>
											</div>
										</div>
										<!-- /dropdown-cart-->
									</li>
									<li>
										<a href="#0" class="wishlist"><span>心愿单</span></a>
									</li>
									<li>
										<div class="dropdown dropdown-access">
											<a href="account.html" class="access_link"><span>账号</span></a>
											<div class="dropdown-menu">
												<a href="#" class="btn_1" id="headinformation">登录或注册</a>
												<ul>								
													<li>
														<a href="./myorder.html"><i class="ti-package"></i>我的订单</a>
													</li>
													<li>
														<a href="./persondetail.html"><i class="ti-user"></i>我的账户</a>
													</li>
													<li id="userloginout" style="display:none;" onclick="loginout()">
														<a href="./login.html"><i class="ti-user"></i>退出账号</a>
													</li>
												</ul>
											</div>
										</div>
										<!-- /dropdown-access-->
									</li>
									<li>
										<a href="javascript:void(0);" class="btn_search_mob"><span>搜索</span></a>
									</li>
									<li>
										<a href="#menu" class="btn_cat_mob">
											<div class="hamburger hamburger--spin" id="hamburger">
												<div class="hamburger-box">
													<div class="hamburger-inner"></div>
												</div>
											</div>
											Categories
										</a>
									</li>
								</ul>
							</div>
						</div>
						<!-- /row -->
					</div>
					<div class="search_mob_wp">
						<input type="text" class="form-control" placeholder="Search over 10.000 products">
						<input type="submit" class="btn_1 full-width" value="Search">
					</div>
					<!-- /search_mobile -->
				</div>
			</header>
			<!-- /header -->

			<main class="bg_gray" style="min-height: 450px;">
				<div class="container margin_30">
					<!-- <div class="page_header">
						<div class="breadcrumbs">
							<ul>
								<li><a href="./index.html">主页</a></li>
								<li><a href="#">我的订单</a></li>
							</ul>
						</div>
						<h1 id="test1">我的订单</h1>
					</div> -->
					<!-- /page_header -->
					<table class="table table-striped order-list" id="orderItems">
						

						
					</table>
				</div>
				<!-- /container -->

		</div>
		<!-- /container -->
		</main>
		<!--/main-->

		<footer class="revealed">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 col-md-6">
						<h3 data-target="#collapse_1">产品</h3>
						<div class="collapse dont-collapse-sm links" id="collapse_1">
							<ul>
								<li><a href="#">最新上市</a></li>
								<li><a href="#">限量发售</a></li>
								<li><a href="#">新品发售日历</a></li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-md-6">
						<h3 data-target="#collapse_2">运动</h3>
						<div class="collapse dont-collapse-sm links" id="collapse_2">
							<ul>
								<li><a href="#">跑步</a></li>
								<li><a href="#">训练</a></li>
								<li><a href="#">足球</a></li>
								<li><a href="#">篮球</a></li>
								<li><a href="#">室外</a></li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-md-6">
						<h3 data-target="#collapse_3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;帮助中心
						</h3>
						<div class="collapse dont-collapse-sm contacts" id="collapse_3">
							<ul>
								<li><a href="#">会员</a></li>
								<li><a href="#">尺码表</a></li>
								<li><a href="#">关于我们</a></li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-md-6">
						<h3 data-target="#collapse_4">联系我们</h3>
						<div class="collapse dont-collapse-sm" id="collapse_4">
							<div id="newsletter">
								<div class="form-group">
									<input type="email" name="email_newsletter" id="email_newsletter"
										class="form-control" placeholder="你的邮箱">
									<button type="submit" id="submit-newsletter"><i
											class="ti-angle-double-right"></i></button>
								</div>
							</div>
							<div class="follow_us">
								<h5>关注我们</h5>
								<ul>
									<li><a
											href="https://weibo.com/n/%e5%8d%8e%e5%8d%97%e5%b8%88%e8%8c%83%e5%a4%a7%e5%ad%a6"><img
												src="img/svg/微博.svg" alt="" class="lazy"></a></li>
									<li><a
											href="https://space.bilibili.com/628111933?from=search&seid=16911714929460060424&spm_id_from=333.337.0.0"><img
												src="img/svg/wf_B站.svg" alt="" class="lazy"></a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
				<!-- /row-->
				<hr>
				<div class="row add_bottom_25">
					<div class="col-lg-6">
						<ul class="footer-selector clearfix">
							<li>
								<div class="styled-select lang-selector">
									<select>
										<option value="Chinese" selected>中文</option>
										<option value="English">English</option>
										<option value="French">French</option>
										<option value="Spanish">Spanish</option>
										<option value="Russian">Russian</option>
									</select>
								</div>
							</li>
						</ul>
					</div>
					<div class="col-lg-6">
						<ul class="additional_links">
							<li><a href="#">SCNU</a></li>
							<li><span>© 2021</span></li>
						</ul>
					</div>
				</div>
			</div>
		</footer>
		<!--/footer-->
		</div>
		<!-- page -->

		<div id="toTop"></div><!-- Back to top button -->

		<!-- COMMON SCRIPTS -->
		<script src="js/common_scripts.min.js"></script>
		<script src="js/main.js"></script>
		<script type="text/javascript">
			function nameLoad() {
				var $theuname = localStorage.getItem("name");
				if ($theuname != null) {
					headimformation.innerHTML = "欢迎你，" + $theuname;
					var userloginout = document.getElementById("userloginout");
					userloginout.style.display = "block";
				}
			}
			
			function loginout() {
				localStorage.clear();
				headimformation.innerHTML = "登录或注册";
			}
			function press(payState, orderID) {
				if (payState != '2') {
						//alert('申请成功！')
					// 1.获取异步对象
						var xhr = new XMLHttpRequest();
						// 4.创建监听 接收响应信息
						xhr.onreadystatechange = function() {
							if (xhr.readyState == 4 && xhr.status == 200) {
								var result = xhr.responseText;
								alert('申请退款成功')
								if (result.length != 0) {
									showOrder();
								}
							}
						}
						// 2.创建请求
						xhr.open("get", `/hzwPro/deleteOrder/${orderID}`, true);
						// 3.发送请求
						xhr.send();
				
				}
				else{
					// 1.获取异步对象
					var xhr = new XMLHttpRequest();
					// 4.创建监听 接收响应信息
					xhr.onreadystatechange = function() {
						if (xhr.readyState == 4 && xhr.status == 200) {
							var result = xhr.responseText;
							alert('收货成功')
							// console.log(result)
							if (result == '1') {
								showOrder();
							}
						}
					}
					// 2.创建请求
					xhr.open("get", `/pro/changeState/${orderID}`, true);
					// 3.发送请求
					xhr.send();
				}
			}
			
			function jump(sid){
				window.location.href="http://127.0.0.1:8080/comment.html?"+sid;
			}
			
			function jump1(sid){
				window.location.href="http://127.0.0.1:8080/productdetail.html?"+sid;
			}
			
			function showOrder() {
				var uname=localStorage.getItem("name");
				// 1.获取异步对象
				var xhr = new XMLHttpRequest();
				// 4.创建监听 接收响应信息
				xhr.onreadystatechange = function() {
					if (xhr.readyState == 4 && xhr.status == 200) {
						var result = xhr.responseText;
						var arr = JSON.parse(result);
						if(arr.length==0){
							orderItems.innerHTML = "没有订单哦！";
							orderItems.style.fontSize="32px";
							return;
						}
						console.log(arr);
						var strHTML=`
						<thead>
							<tr>
								<th>
									订单商品
								</th>
								<th>
									状态
								</th>
								<th>
									收货人
								</th>
								<th>
									电话
								</th>
								<th>
									收货地址
								</th>
							</tr>
						</thead>
						<tbody>
						
						</tbody>`;
						for (var i = 0; i < arr.length; i++) {
							var obj = $.parseJSON(JSON.stringify(arr[i]));
							console.log(obj);
							var bname = obj.paystate == '2' ? '收货' : (obj.paystate == '3'||obj.paystate=='4') ? "退货" : '退款';
							
							strHTML += `<tr>
											<td onclick="jump1(${obj.sid})">
												<div class="thumb_order">
													<img src="${obj.imgurl}" data-src="img/products/shoes/1.jpg" class="lazy" alt="Image">
												</div>
												<span>${obj.sname}&nbsp&nbsp&nbsp&nbsp×${obj.buynum}</span>
											</td>
											<td>${obj.paystate=='0'?'已付款':obj.paystate=='1'?'未发货':'已发货'}</td>
											<td>${obj.rname}</td>
											<td>${obj.rphone}</td>
											<td>${obj.raddress}</td>
											<td>
											<button style='width: 50px;  
        padding:8px;  
        background-color: #428bca;  
        border-color: #357ebd;  
        color: #fff;  
        -moz-border-radius: 10px;  
        -webkit-border-radius: 10px;  
        border-radius: 10px; /* future proofing */  
        -khtml-border-radius: 10px; /* for old Konqueror browsers */  
        text-align: center;  
        vertical-align: middle;  
        border: 1px solid transparent;  
        font-weight: 90;  
        font-size:85% ' type="submit" onclick="press(${obj.paystate}, ${obj.orderID})">${bname}</button>
											</td>
											<td>
																				<button style='width: 50px;  
											padding:8px;  
											background-color: #428bca;  
											border-color: #357ebd;  
											color: #fff;  
											-moz-border-radius: 10px;  
											-webkit-border-radius: 10px;  
											border-radius: 10px; /* future proofing */  
											-khtml-border-radius: 10px; /* for old Konqueror browsers */  
											text-align: center;  
											vertical-align: middle;  
											border: 1px solid transparent;  
											font-weight: 90;  
											font-size:85% ' type="submit" onclick="jump(${obj.sid})">评论</button>
																				</td>
										</tr>`;
						}
						orderItems.innerHTML = strHTML;
					}
				}
				// 2.创建请求
				xhr.open("get", `/pro/showOrder/${uname}`, true);
				// 3.发送请求
				xhr.send();
			}

			function identify() {
				var $theuname = localStorage.getItem("name");
				if ($theuname != null) {
					headinformation.innerHTML = "欢迎你，" + $theuname;
					var userloginout = document.getElementById("userloginout");
					userloginout.style.display = "block";
				} else {
					alert("请先登录！！！");
					location.href = "./login.html";
				}
			}

			function loginout() {
				localStorage.clear();
				headimformation.innerHTML = "登录或注册";
			}
		</script>

	</body>

</html>
